name: Annotate and Build

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  # --- Step 1: The single annotation job ---
  annotate:
    name: Emit annotation
    runs-on: ubuntu-latest
    outputs:
      my_value: ${{ steps.generate.outputs.my_value }}
    steps:
      - id: generate
        run: |
          # Generate whatever value you need
          VALUE="42"
          echo "my_value=$VALUE" >> $GITHUB_OUTPUT

      - name: Emit annotation
        run: echo "::notice title=Global Annotation::My value is ${{ steps.generate.outputs.my_value }}"

  # --- Step 2: A downstream job that uses the value ---
  build:
    name: Build
    needs: annotate
    runs-on: ubuntu-latest
    steps:
      - name: Use annotation value
        run: echo "Building with value ${{ needs.annotate.outputs.my_value }}"
      - name: Write to job summary
        run: "echo '### My annotation: âœ… value=42' >> $GITHUB_STEP_SUMMARY"
        
  # --- Step 3: Another downstream job ---
  test:
    name: Test
    needs: annotate
    runs-on: ubuntu-latest
    steps:
      - name: Use annotation value
        run: echo "Testing with value ${{ needs.annotate.outputs.my_value }}"
      - name: fail on purpose
        run: 1 / 0
